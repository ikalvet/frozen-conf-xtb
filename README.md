# frozen-conf-xtb
A python program that performs frozen coordinate conformational search using GFN2-XTB energies

The purpose of this program is to generate a set of different conformers by rotating only the bonds that the user has defined. This program does not optimize the geometry, it does not change any bond lengths and angles, and it does not rotate any other bonds in the structure. Currently it also does not specifically search for lowest energy structures around each local minima in the conformer landscape. Instead it attempts to find structures that would correspond to distinct minima but would not necessarily be the lowest points there. The idea is that subsequent DFT (or other) geometry optimization methods would be used to push these structures to their corresponding minima.

The program uses random number generator to generate sets of dihedral angles to describe each of these conformers. These conformers are first evaluated for clashes, and if passed their energies are evaluated. GFN2-xTB method by Grimme et al. (https://pubs.acs.org/doi/10.1021/acs.jctc.8b01176) is used to calculate the electronic energies of these conformers. As an output, the energy ranking of N (default = 10) lowest energy conformers is returned, and the structures are saved as .xyz files (as well as a multi-xyz file).

Thanks to XTB, the program has no issues with metals. The program currently does not work with ring-closures (i.e. conformers within the cyclohexane ring, or cyclic peptides, etc...).


<b>Setup / “Installation”</b>

This program currently only works in UNIX systems. Functionality under Windows cannot be guaranteed.

The program itself is just a Python script (written in Python 3), however it requires a number of modules to be installed to be functional:
scipy
numpy
openbabel
xtb-python

<b>Usage</b>

Usage examples:

conf_gen.py benzyl_alcohol.xyz --atoms “1-6 1-4” --per “180 360” --iter 50 --save 5

conf_gen.py filename.xyz --atoms “1-10 2-14 2-15 60-61” --per “360 360 180 120” --iter 500 --save 20

Input variables (mandatory):

filename.xyz or filename.zmat
First variable is the filename of the structure. Currently *.xyz and *.zmat files are supported. 
XYZ file should come in the standard format where the first line is the number of atoms, second line is for comments and from the third line the coordinates start.
ZMAT file needs to come in the format as it is generated by OpenBabel. ZMAT file should be used as input if significant modifications have been done on the originally generated ZMAT file.

One of these must be used:
--atoms #-# #-# - list of atompairs that define the bonds that are going to be rotated. Has to be entered as a space-separated list. Have to use dashes to specify atompairs.
--dihedrals d# d# d# - list of dihedral angle labels that are going to be changed in the conformer search. These labels correspond to those that are generated in the ZMAT file.

Additional options that control the behaviour of the program:

--charge # - (default = 0) - define the charge of your molecule if it’s not 0.

--multi # - (default = 1) - define the multiplicity (number of unpaired electrons + 1) of your molecule if it’s not 1.

--iter ## - (default = 100) - can be used to specify how many iterations (structures) the program will generate and analyze. If omitted, default value will be used.

--save ## - (default = 10) - number of structures that are saved and ranked as the program output. If omitted, default value will be used.

--solvent solvent_name - Enables GBSA solvation model during XTB energy calculations.

--similarity ## or --step ## - (default = 20.0) - threshold dihedral angle for deciding whether the generated geometry is similar to any of the previously analyzed ones. If the structures are found similar, then only the lower energy one is kept.
Two geometries are considered similar only if each of dihedrals in the combination of new dihedrals is found to be within ±threshold of a previously analyzed combination of dihedrals.

For an example, if the newly generated dihedrals for rotating three bonds are [30.0, 65.0, 143.0] and the threshold is 20.0 degrees, then [31.0, 64.0, 100.0] is not similar because the third angle is sufficiently different. [49.0, 46.0, 162.0] would be considered similar because all of the values are within ±20.0 degrees.

The consequence of keeping this value low can be that the output may be saturated with slightly but sufficiently different conformers that are concentrated around a single local minima.
At high threshold finer details of the conformer landscape may be lost because too many realistically different conformers may be considered similar and considered as part of a single local minimum.

--per “# # #” - periodicities of all of the rotations. A space-separated list of values that define the periodicity of each rotation. Periodicity means the smallest rotation around a bond that gives the same structure. For phenyl it would be 180 degrees, for methyl 120 degrees, for any asymmetric group 360 degrees. If this option is not used then the user will be prompted to enter these values for each dihedral during the geometry setup stage (meaning, the program will ask you for the numbers). This reduces unnecessary effort of assessing conformers that are equal due to symmetry.

--constr “d#” or “X-Y” - specify which dihedral should have its rotation constrained to +- a value. Use --per to specify that value. The effect is that this dihedral angle will be sampled only in the range of starting angle +- constraint limit (e.g. 90 .. 150 degrees for 120 +- 30). The input line should look something like: --atoms “10-11 12-15” --per “360 30” --constr “12-15”

--systematic - switches to systematic conformer generation. In this mode the conformer space is sampled systematically, given a list of rotable bonds/dihedrals and any rotation periods and constraints. The step size is defined through the --similarity or --step argument, so by default the torsion will be sampled with 20 degree steps. This approach will very likely by much slower, especially if the step size is reduced.

--test - does not compute any energies or change any geometries, only goes through the geometry setup stage and exits. Useful for generating the ZMAT file and checking that everything makes sense in terms of dihedral definitions.

--man_di_reassign - (can currently be used only with --atoms) if this is used/enabled then two process are initiated in the geometry setup stage:
1) the user will be asked to choose which dihedral should be rotated if the ZMAT is found to contain multiple dihedrals that use the same atom-pair as the central bond.
2) For other dihedrals that also use that atom-pair as the central bond, the user will be asked to enter new 4th atom numbers to redefine these dihedrals.
If this option is not used, then the program automatically picks the first dihedral as the one to rotate, and redefines the other dihedrals by using the first atom of the picked dihedral definition as the 4th atom. This may lead to strange results when the input structure has a strange atom ordering and a lot of the dihedrals end up being defined in very strange ways. If that is the case then --man_di_reassign option should be used, or the user should re-order the atoms.

<i>Example for troubleshooting dihedral definitions:

Say we want to rotate the C-C bond of atoms <b>1</b> and <b>6</b> in the structure of benzyl alcohol. In the ZMAT we can see that these atoms are used as the central bond for two dihedrals, d7 and d8:

...<br>
C  <b>6</b>  r7  <b>1</b>  a7  2  <b>d7</b><br>
C  <b>6</b>  r8  <b>1</b>  a8  2  <b>d8</b><br>
...<br>
d7= 294.47<br>
d8= 114.47<br>
...<br>

If in this case this bond was rotated only by changing the value of d7 by -90.0 degrees, then the result would be a very distorted structure because the position of atom 8 would not change.<br>
![image](https://user-images.githubusercontent.com/30599647/213289740-ed6cd205-8280-46f7-97b6-a39ea7d06eb7.png)

However, if d8 was redefined through some other atom that would be on the same side of the rotating bond as the first atom that defined it (i.e. atom 7), then the structure would not be distorted. In this case d8 would have to be redefined using atom 7.<br>
...<br>
C  <b>6</b>  r7  <b>1</b>  a7  2  <b>d7</b><br>
C  <b>6</b>  r8  <b>1</b>  a8  <b>7</b>  <b>d8</b><br>
...<br>
d7= 294.47<br>
<b>d8= 180.0</b><br>
...</i><br>
![image](https://user-images.githubusercontent.com/30599647/213289764-7eb532cc-caef-4e05-a498-cce3ab99da35.png)

